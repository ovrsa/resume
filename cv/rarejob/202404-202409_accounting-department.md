# 1. 時系列データモニタリングシステムの開発

## 1.1. 目次

- [1. 時系列データモニタリングシステムの開発](#1-時系列データモニタリングシステムの開発)
  - [1.1. 目次](#11-目次)
  - [1.2. プロジェクト概要](#12-プロジェクト概要)
  - [1.3. 期間／規模／役割](#13-期間規模役割)
  - [1.4. 実績](#14-実績)
    - [1.5.1. 背景・課題・問題点](#151-背景課題問題点)
    - [1.5.2. 取り組み](#152-取り組み)
    - [1.5.3. 結果](#153-結果)
  - [1.6. 実施内容2：プラガブルなバックエンド実装](#16-実施内容2プラガブルなバックエンド実装)
    - [1.6.1. 背景・課題・問題点](#161-背景課題問題点)
    - [1.6.2. 取り組み](#162-取り組み)
    - [1.6.3. 結果](#163-結果)
  - [1.7. 実施内容3：OSSライセンスチェック業務を半自動化](#17-実施内容3ossライセンスチェック業務を半自動化)
    - [1.7.1. 背景・課題・問題点](#171-背景課題問題点)
    - [1.7.2. 取り組み](#172-取り組み)
    - [1.7.3. 結果](#173-結果)
  - [1.10. 開発言語・使用技術](#110-開発言語使用技術)

## 1.2. プロジェクト概要

温度やCO2濃度などの時系列実験データをモニタリングするシステムの開発。

## 1.3. 期間／規模／役割

- 2022/09 - 2022/12／3名／メンバー

## 1.4. 実績

- DB選定およびFirestoreにおけるデータモデリング
- クリーンアーキテクチャとCQRSを採用したバックエンド実装（社内初）
- Auth0も対象としたTerraformによるインフラ構成管理（社内初）
- OSSライセンスチェック業務を半自動化（社内初）
- 少人数で作業しやすい開発基盤の整備

---

以下、特筆すべき実施内容のみ記載。

### 1.5.1. 背景・課題・問題点

- お客様が専門とする領域に対する知見が社内に蓄積されていなかった。
- 社内とお客様双方において使用する言葉に揺らぎがあった。
- 入力データのフォーマットが定義されておらず、どのように連携するか整理されていなかった。

### 1.5.2. 取り組み

以下のステップで実施した。

1. 今回のシステムにおいて使用される言葉を意味とともに列挙
2. 前ステップにて列挙した言葉をグルーピング・統一してユビキタス言語策定
3. ユビキタス言語を策定した上で外部インターフェースを設計

### 1.5.3. 結果

- 社内でお客様ドメインの知識が深まり、よりお客様に寄り添う提案ができるようになった。
- 社内・社外のコミュニケーションロスを減らすことができた。
- 事前にユビキタス言語を策定したことで、外部インターフェース設計をスムーズに行うことができた。

## 1.6. 実施内容2：プラガブルなバックエンド実装

将来的にDBMSが変更されることやデータ連携方法が変更されることなどを想定してバックエンドの実装を行なった。

### 1.6.1. 背景・課題・問題点

- 時系列データの利活用がしやすいDBを選定すべきだが、社内で知見がなく、かつ短納期であるため技術調査の時間がない。
- 連携データの追加が繰り返し行われる可能性があるため、RDBの場合はマイグレーションコストが高くなってしまう。
- システム導入後、最低でも半年は時系列データの蓄積・参照がプロジェクトの主眼となっている。

### 1.6.2. 取り組み

以下を実施した。

- データリポジトリやサービス層を柔軟に更新しやすいように、クリーンアーキテクチャおよびCQRSをベースとしてAPIを実装。
- 社内で知見があり、かつデータ拡張がしやすいFirestoreを、システム導入時点ではDBMSとして採用。

### 1.6.3. 結果

- データリポジトリが変更されても柔軟に移行しやすい構成にすることができた。
- 対象とするデータが増えても柔軟に対応できる構成にすることができた。
- 連携データの方法をデータファイルからAPI化することを推進できる、お客様への付加価値提供に貢献することができた。

## 1.7. 実施内容3：OSSライセンスチェック業務を半自動化

GitHub ActionsとTrivyを用いてOSSライセンスチェックを半自動化し、業務効率化を図った。

### 1.7.1. 背景・課題・問題点

- 従来、OSSライセンスチェックは担当者が手作業で行なっていた。
- 従来、OSSライセンスチェックは納品前に行われており、もし使用しているOSSにライセンス上問題があった場合に手戻りコストが膨大になる危険性があった。
- 脆弱性チェックツールとしてTrivyを使用していた。

### 1.7.2. 取り組み

- OSSライセンスチェックツールとして、Trivyを使用。
- ライブラリ・パッケージが追加されたタイミングでGitHub Actionsを実行し、ライセンスチェックを行うためのGitHub Issueを作成するようにした。

### 1.7.3. 結果

- 言語やプラットフォームの違いを吸収したOSSライセンスチェックができるようになった。
- ライブラリ・パッケージが追加されたタイミングでOSSライセンスチェックができるようになった。

## 1.10. 開発言語・使用技術

メイン言語はPython。
一部、開発補助スクリプト作成のためにMakefileやShell Scriptを使用。

| カテゴリ                   | 使用技術         | 使用目的                                                                                                                     |
| -------------------------- | ---------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| Google Cloud               | Cloud Firestore  | 時系列データの保持                                                                                                           |
| Google Cloud               | Cloud Functions  | データ連携処理の起動                                                                                                         |
| Google Cloud               | Cloud Logging    | データ連携処理のログ管理                                                                                                     |
| Google Cloud               | Cloud Monitoring | データ連携処理のエラーやワーニングの通知                                                                                     |
| Google Cloud               | Cloud Run        | バックエンドとなるWeb APIの起動                                                                                              |
| Google Cloud               | Cloud Scheduler  | 定期的に実行が必要なデータ連携処理の起動                                                                                     |
| Google Cloud               | Cloud Storage    | 受領データファイルや中間データファイルの保持                                                                                 |
| Google Cloud               | Secret Manager   | ユーザ・パスワードなど、機密情報の保持・管理                                                                                 |
| コンテナ技術               | Docker           | テスト用のFirestoreエミュレータコンテナやAPIコンテナを作成                                                                   |
| CI/CD                      | GitHub Actions   | CI（フォーマットチェック、リント、テストの自動化、OSSライセンスチェック半自動化）、CD（Cloud Functionsなどのデプロイ自動化） |
| ライブラリ・フレームワーク | FastAPI          | Web APIの実装                                                                                                                |
| ライブラリ・フレームワーク | google-cloud-xxx | Cloud Storageなど、Google Cloudサービスの利用                                                                                |
| ライブラリ・フレームワーク | pandas           | ファイル読込時のデータチェック、重複除去、デフォルト値補完、データ変換など                                                   |
| ライブラリ・フレームワーク | pydantic         | データ構造をモデル化・インスタンス化、コンフィグ                                                                             |
| ライブラリ・フレームワーク | black, isort     | Pythonコードのフォーマット                                                                                                   |
| ライブラリ・フレームワーク | mypy, pylint     | Pythonコードのリント                                                                                                         |
| ライブラリ・フレームワーク | pytest           | Pythonコードのテスト全般                                                                                                     |
| ライブラリ・フレームワーク | pytest-docker    | テスト時に使用するFirestoreエミュレータコンテナの自動起動                                                                    |
| その他ツール               | Slack            | チームメンバーとの情報共有                                                                                                   |